<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Timer</title>
    <style>
      table,
      td,
      th {
        border: 1px solid;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Online Timer</h1>
      <h4>Current Time(1000x faster): <span id="current"></span></h4>
      <button id="edit-btn" onclick="edit()">Edit</button>
      <button id="done-btn" onclick="done()" style="display: none">Done</button>
      <table id="org-table">
        <thead>
          <th>Time</th>
          <th>Alert Word</th>
        </thead>
        <tbody>
          <tr>
            <td class="time">03:30</td>
            <td class="msg">Wake up</td>
          </tr>
          <tr>
            <td class="time">03:45</td>
            <td class="msg">Lunch time</td>
          </tr>
          <tr>
            <td class="time">04:00</td>
            <td class="msg">Take a break</td>
          </tr>
        </tbody>
      </table>
    </div>
    <script>
      let now = new Date();
      let hours = now.getHours();
      let minutes = now.getMinutes();
      let curr = document.getElementById("current");
      let seconds = 0;

      let alertTime = [];
      let doneFlags = [];

      let times = document.querySelectorAll(".time");
      let msges = document.querySelectorAll(".msg");

      for (let i = 0; i < times.length; i++) {
        var obj = {
          time: times[i].innerHTML,
          msg: msges[i].innerHTML,
        };
        alertTime.push(obj);
        doneFlags.push(false);
      }

      let orgTable = document.getElementById("org-table");
      let editBtn = document.getElementById("edit-btn");
      let doneBtn = document.getElementById("done-btn");

      function edit() {
        editBtn.style.display = "none";
        doneBtn.style.display = "block";

        displayEditTable();
      }

      function done() {
        editBtn.style.display = "block";
        doneBtn.style.display = "none";
        displayOrgTable();
      }

      function remove(i) {
        console.log(i);
        alertTime.splice(i, 1);
        displayEditTable();
      }

      function displayEditTable() {
        orgTable.innerHTML = "";
        for (let i = 0; i < alertTime.length; i++) {
          let row = document.createElement("tr");
          let d1 = document.createElement("td");
          let d2 = document.createElement("td");
          let d3 = document.createElement("td");

          let input = document.createElement("input");
          input.type = "time";
          input.value = alertTime[i].time;

          input.addEventListener("input", (e) => {
            alertTime[i].time = e.target.value;
          });

          let input2 = document.createElement("input");
          input2.type = "text";
          input2.value = alertTime[i].msg;

          input2.addEventListener("input", (e) => {
            alertTime[i].msg = e.target.value;
          });

          let removeBtn = document.createElement("button");
          removeBtn.innerHTML = "Remove";
          removeBtn.addEventListener("click", () => {
            remove(i);
          });

          d1.appendChild(input);
          d2.appendChild(input2);
          d3.appendChild(removeBtn);

          orgTable.appendChild(row);
          row.appendChild(d1);
          row.appendChild(d2);
          row.appendChild(d3);
        }

        let addBtn = document.createElement("button");
        addBtn.innerHTML = "Add Row";
        orgTable.appendChild(addBtn);
        addBtn.onclick = function () {
          add();
        };
      }

      function add() {
        let newAlert = {
          time: "",
          msg: "",
        };

        alertTime.push(newAlert);
        doneFlags[alertTime.length - 1] = false;
        displayEditTable();
      }

      function displayOrgTable() {
        orgTable.innerHTML = "";
        let head = document.createElement("thead");
        let row = document.createElement("tr");
        let time = document.createElement("td");
        let text = document.createElement("td");

        time.innerHTML = "Time";
        text.innerHTML = "Alert Word";

        row.appendChild(time);
        row.appendChild(text);
        head.appendChild(row);
        orgTable.appendChild(head);
        for (let i = 0; i < alertTime.length; i++) {
          let row = document.createElement("tr");
          let time = document.createElement("td");
          let text = document.createElement("td");

          time.innerHTML = alertTime[i].time;
          text.innerHTML = alertTime[i].msg;

          row.appendChild(time);
          row.appendChild(text);
          orgTable.appendChild(row);
        }
      }

      setInterval(() => {
        seconds++;
        if (seconds >= 60) {
          seconds = 0;
          minutes++;
        }
        if (minutes >= 60) {
          minutes = 0;
          if (hours < 24) {
            hours++;
          } else {
            hours = 0;
          }
        }

        let timeString =
          (hours < 10 ? "0" : "") +
          hours +
          ":" +
          (minutes < 10 ? "0" : "") +
          minutes;
        curr.innerHTML = timeString;

        for (var i = 0; i < alertTime.length; i++) {
          var obj = alertTime[i];
          console.log(obj);
          if (obj.time == timeString && doneFlags[i] == false) {
            alert(obj.msg);
            doneFlags[i] = true;
          }
        }
      }, 1);
    </script>
  </body>
</html>
